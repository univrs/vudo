# VUDO Genesis: Claude-Flow Swarm Configuration
# Year 1 - DOL Self-Hosting

name: vudo-genesis-y1
version: 0.1.0
description: |
  Multi-agent swarm for making DOL 2.0 Turing complete and self-hosting.
  Targets: Specification → Implementation → Testing → Bootstrap

# Global configuration
config:
  max_concurrent_agents: 4
  checkpoint_interval: 1h
  artifact_dir: ./artifacts
  log_level: info
  
# Shared context available to all agents
context:
  project: VUDO Genesis
  year: 1
  goal: DOL self-hosting via WASM
  docs:
    - ./docs/01-VUDO-OS-VISION.md
    - ./docs/02-DOL-2.0-SPECIFICATION.md
    - ./docs/03-THREE-YEAR-ROADMAP.md

# Agent definitions
agents:
  # ═══════════════════════════════════════════════════════════════════
  # ORCHESTRATOR
  # ═══════════════════════════════════════════════════════════════════
  orchestrator:
    role: coordinator
    model: claude-sonnet-4-20250514
    description: Central coordinator managing dependencies and progress
    tools:
      - project_state
      - agent_dispatch
      - conflict_resolution
      - progress_report
    responsibilities:
      - Track task dependencies and completion
      - Resolve blocking issues between agents
      - Generate milestone reports
      - Escalate critical decisions
    
  # ═══════════════════════════════════════════════════════════════════
  # SPECIFICATION AGENTS
  # ═══════════════════════════════════════════════════════════════════
  dol-type-spec:
    role: specification
    model: claude-sonnet-4-20250514
    stream: spec-stream
    description: DOL 2.0 type system specification
    tools:
      - file_read
      - file_write
      - dol_validate
    inputs: []
    outputs:
      - spec/types/primitives.spec.dol
      - spec/types/composites.spec.dol
      - spec/types/ontology.spec.dol
      - spec/types/aliases.spec.dol
    validation:
      - All types have MLIR lowering
      - No circular dependencies
      - DOL 1.0 compatibility preserved
    prompt: |
      Design the DOL 2.0 type system. Include:
      - Primitive types mapping to MLIR (Int8-64, Float32/64, Bool, String)
      - Composite types (Array, Slice, Pointer, Optional, Result, Tuple)
      - Ontological types (Gene, Trait, Constraint, System, Evolves)
      - Type alias and struct syntax
      
      Write specifications in DOL format with exegesis sections.
      Document MLIR lowering for each type.

  dol-control-spec:
    role: specification
    model: claude-sonnet-4-20250514
    stream: spec-stream
    description: DOL 2.0 control flow specification
    tools:
      - file_read
      - file_write
      - dol_validate
    inputs:
      - spec/types/*.spec.dol
    outputs:
      - spec/control/conditionals.spec.dol
      - spec/control/matching.spec.dol
      - spec/control/loops.spec.dol
      - spec/control/expressions.spec.dol
    dependencies:
      - dol-type-spec
    validation:
      - Maps to MLIR SCF dialect
      - Exhaustive match defined
      - Expression/statement contexts clear
    prompt: |
      Design DOL 2.0 control flow constructs:
      - Conditionals: if/else/else if
      - Pattern matching: match/case with guards
      - Loops: for/while/loop with break/continue
      - Expression vs statement contexts
      
      Ensure all constructs map to MLIR SCF dialect.

  dol-compose-spec:
    role: specification
    model: claude-sonnet-4-20250514
    stream: spec-stream
    description: DOL 2.0 functional composition specification
    tools:
      - file_read
      - file_write
      - dol_validate
    inputs:
      - spec/types/*.spec.dol
      - spec/control/*.spec.dol
    outputs:
      - spec/compose/pipe.spec.dol
      - spec/compose/lambda.spec.dol
      - spec/compose/higher-order.spec.dol
      - spec/compose/operators.spec.dol
    dependencies:
      - dol-type-spec
      - dol-control-spec
    validation:
      - Type inference complete
      - Closure semantics defined
      - Partial application specified
    prompt: |
      Design DOL 2.0 functional composition:
      - Pipe operator |> (left-to-right)
      - Compose operator >> (function pipelines)
      - Apply @ and bind := operators
      - Lambda expressions with closures
      - Higher-order function types
      
      Define type inference rules for all constructs.

  dol-meta-spec:
    role: specification
    model: claude-sonnet-4-20250514
    stream: spec-stream
    description: DOL 2.0 meta-programming specification
    tools:
      - file_read
      - file_write
      - dol_validate
    inputs:
      - spec/types/*.spec.dol
      - spec/control/*.spec.dol
      - spec/compose/*.spec.dol
    outputs:
      - spec/meta/quote.spec.dol
      - spec/meta/eval.spec.dol
      - spec/meta/macro.spec.dol
      - spec/meta/reflect.spec.dol
    dependencies:
      - dol-type-spec
      - dol-control-spec
      - dol-compose-spec
    validation:
      - Hygiene rules prevent capture
      - Type info preserved in quote/eval
      - Reflection is read-only
    prompt: |
      Design DOL 2.0 meta-programming:
      - Quote ' (capture as AST)
      - Eval ! (execute AST)
      - Macro # (compile-time generation)
      - Reflect ? (type introspection)
      
      Define hygiene rules and scoping semantics.

  # ═══════════════════════════════════════════════════════════════════
  # IMPLEMENTATION AGENTS
  # ═══════════════════════════════════════════════════════════════════
  dol-lexer-impl:
    role: implementation
    model: claude-sonnet-4-20250514
    stream: impl-stream
    description: Extend DOL lexer for 2.0 syntax
    tools:
      - file_read
      - file_write
      - cargo_build
      - cargo_test
    inputs:
      - spec/**/*.spec.dol
      - src/lexer.rs  # existing
    outputs:
      - src/lexer.rs
      - src/tokens.rs
    dependencies:
      - dol-type-spec
      - dol-control-spec
      - dol-compose-spec
      - dol-meta-spec
    validation:
      - All spec tokens recognized
      - No ambiguous tokenization
      - 100% test coverage
    prompt: |
      Extend the DOL lexer (Logos-based) for 2.0 syntax:
      - Add keyword tokens: if, match, for, while, loop, etc.
      - Add operators: |>, >>, @, :=, ', !, #, ?
      - Add type-related tokens
      - Maintain span tracking for diagnostics
      
      Preserve backward compatibility with DOL 1.0.

  dol-parser-impl:
    role: implementation
    model: claude-sonnet-4-20250514
    stream: impl-stream
    description: Extend DOL parser for 2.0 syntax
    tools:
      - file_read
      - file_write
      - cargo_build
      - cargo_test
    inputs:
      - spec/**/*.spec.dol
      - src/lexer.rs
      - src/tokens.rs
    outputs:
      - src/parser.rs
      - src/ast.rs
    dependencies:
      - dol-lexer-impl
    validation:
      - All spec examples parse
      - Error recovery works
      - AST round-trips
    prompt: |
      Extend the DOL parser (recursive descent) for 2.0 syntax:
      - Parse type declarations and aliases
      - Parse control flow constructs
      - Parse functional composition
      - Parse meta-programming constructs
      
      Use precedence climbing for operators.
      Produce AST with full span information.

  dol-typecheck-impl:
    role: implementation
    model: claude-sonnet-4-20250514
    stream: impl-stream
    description: Implement DOL 2.0 type checker
    tools:
      - file_read
      - file_write
      - cargo_build
      - cargo_test
    inputs:
      - spec/types/*.spec.dol
      - src/ast.rs
    outputs:
      - src/typecheck.rs
      - src/types.rs
      - src/constraints.rs
    dependencies:
      - dol-parser-impl
    validation:
      - Type errors are clear
      - Inference succeeds on valid code
      - Constraint solving terminates
    prompt: |
      Implement DOL 2.0 type checker:
      - Bidirectional type inference
      - Constraint solving for generics
      - Trait implementation checking
      - Constraint validation for Gene types
      
      Produce helpful error messages with suggestions.

  dol-ir-impl:
    role: implementation
    model: claude-sonnet-4-20250514
    stream: impl-stream
    description: Implement DOL high-level IR
    tools:
      - file_read
      - file_write
      - cargo_build
      - cargo_test
    inputs:
      - src/ast.rs
      - src/typecheck.rs
    outputs:
      - src/hir.rs
      - src/ast_to_hir.rs
      - src/hir_opt.rs
    dependencies:
      - dol-typecheck-impl
    validation:
      - All AST nodes lower
      - Types preserved
      - HIR validates
    prompt: |
      Implement DOL High-Level IR:
      - Define HIR node types (simpler than AST)
      - Lower typed AST to HIR
      - Implement basic optimizations (constant folding, dead code)
      - Prepare for MLIR lowering
      
      HIR should be independent of source syntax.

  dol-emit-impl:
    role: implementation
    model: claude-sonnet-4-20250514
    stream: impl-stream
    description: Implement WASM code generation
    tools:
      - file_read
      - file_write
      - cargo_build
      - cargo_test
      - wasm_validate
    inputs:
      - src/hir.rs
    outputs:
      - src/emit_mlir.rs
      - src/emit_wasm.rs
      - src/debug_info.rs
    dependencies:
      - dol-ir-impl
    validation:
      - WASM validates
      - Programs execute correctly
      - Debug info works
    prompt: |
      Implement DOL code generation:
      - Emit MLIR from HIR
      - Lower MLIR to LLVM IR
      - Generate WebAssembly binary
      - Include DWARF debug information
      
      Focus on correctness before optimization.

  dol-mcp-impl:
    role: implementation
    model: claude-sonnet-4-20250514
    stream: impl-stream
    description: Implement MCP server for AI compilation
    tools:
      - file_read
      - file_write
      - cargo_build
      - cargo_test
    inputs:
      - src/emit_wasm.rs
      - src/typecheck.rs
    outputs:
      - src/mcp/server.rs
      - src/mcp/tools.rs
      - src/mcp/schema.json
    dependencies:
      - dol-emit-impl
    validation:
      - Tools callable from Claude
      - Errors useful for AI
      - Streaming works
    prompt: |
      Implement DOL MCP server:
      - Define tool schemas (compile, validate, format)
      - Handle compilation requests
      - Stream diagnostics
      - Return structured errors
      
      Design for AI agent consumption.

  # ═══════════════════════════════════════════════════════════════════
  # TESTING AGENTS
  # ═══════════════════════════════════════════════════════════════════
  dol-unit-test:
    role: testing
    model: claude-sonnet-4-20250514
    stream: test-stream
    description: Unit tests for DOL components
    tools:
      - file_read
      - file_write
      - cargo_test
      - coverage_report
    outputs:
      - tests/lexer/*.rs
      - tests/parser/*.rs
      - tests/typecheck/*.rs
      - tests/ir/*.rs
    continuous: true
    validation:
      - 90%+ coverage
      - All spec examples covered
      - Edge cases tested
    prompt: |
      Create comprehensive unit tests:
      - Test every token type in lexer
      - Test every AST node in parser
      - Test type inference cases
      - Test IR transformations
      
      Include both positive and negative tests.
      Generate coverage reports.

  dol-integration-test:
    role: testing
    model: claude-sonnet-4-20250514
    stream: test-stream
    description: End-to-end integration tests
    tools:
      - file_read
      - file_write
      - cargo_test
      - wasm_run
      - benchmark
    inputs:
      - src/emit_wasm.rs
    outputs:
      - tests/integration/*.rs
      - tests/e2e/*.dol
      - benchmarks/
    dependencies:
      - dol-emit-impl
    validation:
      - Full pipeline works
      - Benchmarks pass
      - Examples execute correctly
    prompt: |
      Create integration tests:
      - Compile example .dol files to WASM
      - Execute WASM and verify output
      - Benchmark compilation time
      - Test error cases end-to-end
      
      Cover the complete pipeline.

  dol-selfhost-test:
    role: testing
    model: claude-sonnet-4-20250514
    stream: test-stream
    description: Self-hosting validation
    tools:
      - file_read
      - file_write
      - cargo_build
      - wasm_run
      - diff
    inputs:
      - All spec files
      - All impl outputs
    outputs:
      - dol/lexer.dol
      - dol/parser.dol
      - dol/typecheck.dol
      - dol/emit.dol
      - dol/main.dol
      - bootstrap.sh
    dependencies:
      - dol-integration-test
    validation:
      - DOL compiles itself
      - Output matches Rust version
      - Bootstrap script succeeds
    prompt: |
      Achieve DOL self-hosting:
      1. Write DOL lexer in DOL
      2. Write DOL parser in DOL
      3. Write DOL type checker in DOL
      4. Write DOL emitter in DOL
      5. Verify self-compilation produces identical output
      
      This is the ultimate validation of DOL 2.0.

# ═══════════════════════════════════════════════════════════════════
# WORKFLOWS
# ═══════════════════════════════════════════════════════════════════
workflows:
  full-genesis:
    description: Complete Year 1 execution
    stages:
      - name: specification
        agents:
          - dol-type-spec
          - dol-control-spec  # waits for types
          - dol-compose-spec  # waits for types
          - dol-meta-spec     # waits for all
        parallel: partial
        
      - name: implementation
        agents:
          - dol-lexer-impl
          - dol-parser-impl
          - dol-typecheck-impl
          - dol-ir-impl
          - dol-emit-impl
          - dol-mcp-impl
        parallel: false  # sequential dependencies
        
      - name: testing
        agents:
          - dol-unit-test      # continuous
          - dol-integration-test
          - dol-selfhost-test
        parallel: partial

  quick-validate:
    description: Validate current state
    stages:
      - name: test
        agents:
          - dol-unit-test
          - dol-integration-test

# ═══════════════════════════════════════════════════════════════════
# TOOLS
# ═══════════════════════════════════════════════════════════════════
tools:
  file_read:
    description: Read file contents
    
  file_write:
    description: Write file contents
    
  cargo_build:
    description: Build Rust crate
    command: cargo build
    
  cargo_test:
    description: Run Rust tests
    command: cargo test
    
  dol_validate:
    description: Validate DOL syntax
    command: dol validate
    
  wasm_validate:
    description: Validate WASM binary
    command: wasm-validate
    
  wasm_run:
    description: Execute WASM
    command: wasmtime
    
  coverage_report:
    description: Generate test coverage
    command: cargo tarpaulin
    
  benchmark:
    description: Run benchmarks
    command: cargo bench
    
  diff:
    description: Compare files
    command: diff

# ═══════════════════════════════════════════════════════════════════
# CHECKPOINTS
# ═══════════════════════════════════════════════════════════════════
checkpoints:
  q1-specs-complete:
    trigger: all_outputs_exist
    agents:
      - dol-type-spec
      - dol-control-spec
      - dol-compose-spec
      - dol-meta-spec
    action: notify
    
  q2-parser-complete:
    trigger: tests_pass
    agents:
      - dol-parser-impl
      - dol-typecheck-impl
    action: notify
    
  q3-emit-complete:
    trigger: tests_pass
    agents:
      - dol-emit-impl
    action: notify
    
  q4-selfhost:
    trigger: custom
    condition: |
      bootstrap.sh succeeds AND
      diff dol-stage1.wasm dol-stage2.wasm returns identical
    action: celebrate
